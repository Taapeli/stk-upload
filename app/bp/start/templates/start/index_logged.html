{# start/index_logged.html_ #}
{% extends "start/s_layout.html" %}
{% block title %}{{ _("Isotammi User's Start Page") }}{% endblock %}
{% block body %}
  {{ super() }}
  {% from "start/s_macros.html" import hamburger_menu with context %}

  {{ hamburger_menu( (
   ) ) }}
<style>
  div.starters span.strow {
      padding: 2pt;
      display: inline-flex;
  }
.startbox ul, startbox2 ul {
    list-style-type: none;
    margin-left: -1.5em;
}
ul li {
    list-style-type: none;
}
ul p {
    margin-left: -1em;
}
div.strow1, div.strow2 {
    display: inline-block;
/*     border: solid 1px pink; */
    vertical-align: text-top;
}
div.strow1 {
    width: 8.5em;
    min-height: 2em;
}
div.strow2 { 
    width: calc(100% - 9em);
}
</style>

<div id="startdiv">
  <div>
    <h1>{{ _("User's home page for Isotammi Services") }}</h1>

{% include "flash_messages.html" %}
{% set batch_id = session['batch_id'] %}<!-- current batch '{{batch_id}}' -->

    <div class="row">

{% if current_user.is_authenticated and 
   (current_user.has_role('gedcom') or current_user.has_role('research')) %}
        <div class="startbox gedtools">
            <div style="display: inline-block;">
                <form method="get" action="/gedcom">

                    <h2>{{ _('Gedcom tools') }}</h2>

                    <p>{{ _('Use these Gedcom tools to improve the quality of your own file or any file you have recieved.') }}</p>
                    <p>{{ _('Return the improved file back to your genealogy software.') }}</p>
                    <div class="submit"> 
                        <button type="submit">{{ _('Gedcom tools') }}</button>
                    </div>
                </form>
            </div>
        </div>
{% endif %}

{% if current_user.is_authenticated and current_user.has_role('research') %}
        <div class="startbox">
            <div style="display: inline-block;">

                <h2>{{ _('Manage Materials') }}</h2>

                <form action="/gramps/uploads">
                    <p>{{ _('You may import your new material to Isotammi and work with existing materials.') }}</p>
                    <p>{{ _('You may also check in which phase your materials are.') }}</p>
                    <div class="submit"> 
                        <input type="submit" value="{{ _('Look at your materials') }}" />
                    </div>
                </form>
            </div>
        </div>
{% endif %}           


{% if current_user.is_authenticated and 
   ( current_user.has_role('research') or current_user.has_role('admin') ) %}
        <div class="startbox">
            <div style="display: inline-block;">

                <h2>{{ _('Browse Common Materials') }}</h2>
                <p>{{ _('View different approved common data') }}.</p>

                <ul>
                    <li>
                        <form method="get" action="/scene/material/common">
                            <div>
    {% for m in commons  %}
                                <div class="typedesc strow1">
                                    <input type="hidden" name="state" value="Accepted">
                                    <button type="submit"  title="{{ _(m.material_type) }}"
                                        name="material_type" value="{{m.material_type}}"
        {% if m.material_type == last_material_type %}
                                        autofocus
        {% endif -%}
                                        >{{ _(m.material_type) }}</button>
                                </div>
                                <div class="strow2">
        {% if m.material_type == "Family Tree" %}{{ _('Approved Isotammi tree') }}<br/>
        {% endif -%}
                                    {{ m.count }} {{ _('approved batches') }}
                                </div>
    {% endfor %}
                            </div>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
{% endif %}

{% if current_user.is_authenticated and 
   ( current_user.has_role('research') or current_user.has_role('admin') ) %}
        <div
    {% if batches|count > 3 %} class="startbox2"
    {% else %} class="startbox"
    {% endif -%}>
            <div style="display: inline-block;">

                <h2>{{ _('Browse My Materials') }}</h2>

<!--                 <p>{{ _('View your own candidate materials') }}.</p> -->
                <ul>
    {% for root in batches | sort(attribute='state')  %}
            {% if not loop.previtem %}
                    <p>{{ _("In state") }} {{ _(root.state) }}</p>
                    <div class="starters">
            {% else %}
                {% if loop.previtem.state != root.state %}
                    </div>
                    <p>{{ _("In state") }} {{ _(root.state) }}</p>
                    <div class="starters">
                {% endif %}
            {% endif %}

        {# if root.state == "Candidate" #}
                    <li>
                        <form method="post" action="/scene/material/batch">
            {% if root.description %}
                  {% set title = _(root.material_type) + " / " + root.description %}
            {% else %}{% set title = _(root.material_type) %}
            {% endif -%}
                        <div>
                            <div class="strow1">
                                <input type="hidden" name="material_type" value="{{root.material_type}}">
                                <input type="hidden" name="state" value="{{root.state}}">
                                <button type="submit" name="batch_id" value="{{ root.id }}"
            {% if batch_id == root.id %}autofocus{% endif %}
                                    title="{{ title }}">{{ root.id }}</button>
                            </div>
                            <div class="strow2"><span class="typedesc">{{ _(root.material_type) }}</span>
                                {{ root.filename()|replace('_',' ') }}
            {% if root.description %}
                                <br/><i>{{ root.description }}</i>
            {% endif -%}
                            </div>
                        </div>
                    </form>
                    </li>
        {# endif -#}
    {% endfor -%}
                </ul>
            </div>
        </div>
{% endif %}


{% if current_user.is_authenticated and (current_user.has_role('audit') ) %}
        <div class="startbox audit">
            <div style="display: inline-block;">
                <form method="get" action="/audit">

                    <h2>{{ _('Isotammi auditor') }}</h2>

                    <p>{{ _('Operations between user candidate materials and Isotammi database') }}.</p>
                    <div class="submit"> 
                        <button type="submit">{{ _('Audit materials') }}</button>
                    </div>
                </form>
            </div>
        </div>
{% endif %}

{% if current_user.is_authenticated and 
            (current_user.has_role('admin') or current_user.has_role('master') ) %}
        <div class="startbox admin">
            <div style="display: inline-block;">
                <form method="get" action="/admin">

                    <h2>{{ _('Admin Operations') }}</h2>

                    <p>{{ _('Manage users, reference data sets and do database maintenance tasks') }}.</p>
                    <div class="submit"> 
                        <button type="submit">{{ _('Maintenance') }}</button>
                    </div>
                </form>
            </div>
        </div>
{% endif %}

        <div class="startbox">
            <div style="display: inline-block;">
                <form method="get" action="http://wiki.isotammi.net/wiki/TyÃ¶kaluja" target="_blank">

                    <h2>{{ _('Tools and Links') }}</h2>

                    <p>{{ _('Study our supplementary stand-alone and Gramps utilities in our tools page') }}.</p>
                    <div class="submit"> 
                        <button type="submit">{{ _('Help page') }}</button>
                    </div>
                </form>
            </div>
        </div>

    </div>{# row #}

  </div>
</div>
{% endblock %}
