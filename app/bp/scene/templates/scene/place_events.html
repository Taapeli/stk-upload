{# _myapp/templates/k_place_events.html_ #}
{% extends "/scene/layout.html" %}
{% block title %}{{ _('Place events') }}{% endblock %}
{% block body %}
{{ super() }}
{% import '/scene/macros.html' as macro with context %}
<!-- link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" 
    integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<h2>{{ _('Place events') }}</h2>
{{ macro.menu(4) }}

    <div class="content" id="IndividualDetail">
      {% if place.coord %}
        <div id="map">{% if '°' in place.coord %}
        {{ _('Invalid coordinates') }}: {{place.coord}}
        &mdash; {{ _('should be in decimal format') }}
        {% else %}{% set r = 0.15 %}
            {% set y = place.coord[0] %}
            {% set x = place.coord[1] %}
            <iframe width="250" height="250" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" 
            src="http://www.openstreetmap.org/export/embed.html?bbox={{
             x - r }}%2C{{ y - r }}%2C{{ x + r  }}%2C{{ y + r 
             }}&amp;layer=mapnik&amp;marker={{place.coord[0]}}%2C{{place.coord[1]}}" 
            style="border: 1px solid black"></iframe><br/><!--small--><a 
            href="http://www.openstreetmap.org/?mlat={{place.coord[0]}}&amp;mlon={{
             place.coord[1]}}#map=9/{{place.coord[0]}}/{{place.coord[1]}}">
            - {{ _('OpenStreetMap on a larger scale') }}</a><!--/small--><br>
            <a target="_blank" href="https://www.google.fi/maps/@{{place.coord[0]}},{{place.coord[1]}},14z?hl=fi">
            - {{ _('on Google Map') }}</a><br>&nbsp;<br>
            {{ _('Location') }}: N&nbsp;{{ '{0:0.4f}'.format(place.coord[0]) }}, 
            E&nbsp;{{ '{0:0.4f}'.format(place.coord[1]) }}
        {% endif %}</div>
      {% endif %}

    <h3 style="position:sticky; top:0;">{{place.pname|join('<br>'|safe)}}</h3>
        <div>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ol  class='flashes'>
        {% for category, message in messages %}
          <li class='flash_{{category}}'>{{ message }}</li>
        {% endfor %}
        </ol>
      {% endif %}
    {% endwith %}
            <ul>{% for p in locations %}
                <li style="margin-left: {{p.level * 2}}em;">
                {% if p.uniq_id == locid|int %}<span class="id">{{p.uniq_id}}</span>
                    <b>{{p.pname|join(' • ')}}</b>
                {% else %}<a href="/scene/location={{p.uniq_id}}"><span class="id">{{p.uniq_id}}</span></a>
                    {{p.pname|join(' • ')}}
                {% endif %} <span class="typedesc">&nbsp;{{p.type|transl('lt')}}</span></li>
            {% endfor %}</ul>
        </div>
    {% if place.notes %}
        <div id="events">
            <h4>{{ _('Website') }}</h4>
            <table class="infolist eventlist">
                <thead>
                    <tr>
                        <th> </th>
                        <th class="ColumnDescription">{{ _('Type') }}</th>
                        <th class="ColumnDescription">{{ _('Reference') }}</th>
                        <th class="ColumnDescription">{{ _('Note') }}</th>
                    </tr>
                </thead>
                <tbody>
        {% for u in place.notes %}
                    <tr>
                        <td class="ColumnValue" title="{{ _('Private data') }}">{{ macro.lock(u.priv) }}</td> 
                        <td class="ColumnDescription">{{u.type|transl('urlt')}}</td> 
                        <td class="ColumnDescription">
                            <a href="{{u.url}}" class="outlink">{{u.description}}</a></td> 
                        <td class="ColumnDescription">{{u.text}}</td> 
                    </tr>
         {% endfor %}
                 </tbody>
            </table>
        </div>
    {% endif %}
    {% if place.noteref_hlink %}
        <div id="notes">
            <h4>{{ _('Note') }}</h4>
            <table class="infolist notelist">
                <thead>
                    <tr>
                        <th> </th>
                        <th class="ColumnDescription">{{ _('Type') }}</th>
                        <th class="ColumnDescription">{{ _('Additional Information') }}</th>
                    </tr>
                </thead>
                <tbody>
        {% for n in place.noteref_hlink %}
                    <tr>
                        <td class="ColumnValue" title="{{ _('Private data') }}">{{ macro.lock(n.priv) }}</td> 
                        <td class="ColumnDescription">{{n.type|transl('notet')}}</td> 
                        {% if n.url %}
                        <td class="ColumnDescription"><a href="{{n.url}}">{{n.text}}</a></td>
                        {% else %}
                        <td class="ColumnDescription">{{n.text}}</td>
                        {% endif %}
                    </tr>
         {% endfor %}
                 </tbody>
            </table>
        </div>
    {% endif %}
        <div id="events"> <!--class="subsection"-->
            <h4>{{ _('Events') }}</h4>
    {% if events %}
            <table class="infolist eventlist">
                <thead>
                    <tr>
                        <th class="ColumnId">{{ _('Person') }}</th>
                        <th class="ColumnPerson">{{ _('Name') }}</th>
                        <th class="ColumnEvent">{{ _('Event') }}</th>
                        <th class="ColumnDate">{{ _('Date') }}</th>
 <!--                   <th class="ColumnDescription">{{ _('Description') }}</th>
                        <th class="ColumnNotes">{{ _('Note') }}</th>
                        <th class="ColumnSources">{{ _('Sources') }}</th>
-->
                    </tr>
                </thead>
                <tbody>
        {% for e in events|sort(attribute='date') %}
                    <tr>
                        <td class="ColumnPerson">
                            <a href="/scene/person={{e.uid}}" class="id"
                              title="{{ _("See Person's Details") }}">{{e.uid}}</a>
                        </td>
                        <td>{% for n in e.names|sort %} 
                         {% if n[0] != "Birth Name" %}
                            <span class="typedesc">{{n[0]|transl('nt')}}</span>
                         {% endif %}
                         {{n[1]}} 
                         {% if n[2] %}
                            <b>{{n[2]}}</b>
                         {% else %}
                            <i>{{n[3]}}</i>
                         {% endif %}
                         <br />{% endfor %}
                        </td>
                        <td class="ColumnEvent">{{e.type|transl('evt')}}
                          {% if e.role != "Primary" %}<span class="typedesc">({{e.role|transl('role')}})</span>{% endif %}</td>
                        <td class="ColumnDate">{% if e.dates %}{{e.dates}}{% else %}–{% endif %}</td>
<!--
                        <td class="ColumnDescription">&nbsp;</td>
                        <td class="ColumnNotes">
                            <div></div>
                        </td>
                        <td class="ColumnSources">
                         <!-- generoi href="#sref3a">3a</a>
                        </td>
-->
                    </tr>
         {% endfor %}
                 </tbody>
            </table>
    {% else %}
        <p>{{ _('No events') }}</p>
    {% endif %}
        </div>

<!--    <div class="subsection" id="sourcerefs">
            <h4>{{ _('Source References') }}</h4>
            <p>{{ _('No source pointers found') }}</p>
        </div>
-->
    </div>
{% endblock %}

