{# _myapp/templates/k_persons.html_ #}
{% extends "/scene/layout.html" %}
{% block title %}{{ _('List of persons') }}{% endblock %}
{% block body %}
{{ super() }}
{% import '/scene/macros.html' as macro %}
{% set cnt = persons | count %}

{% if rule[0] == 'all' %}<h2>{{ _('Persons ordered by') }}</h2>
{% elif rule[0] == 'refname' %}<h2>{{ _('Persons carrying a Name') }} {{ rule[1] }}</h2>
{% else %}<H2>{{ _('Persons') }}</h2>
{% endif %}

<!-- Rule = {{rule}} for {{cnt}} persons -->

{{ macro.menu(menuno) }}e
	<div class="content" id="Individuals">
        <div id="summaryarea">
            <p id="description">{{ ngettext(
    			'Displaying %(num)s person names.', 
    			'Displaying %(num)s person names.', cnt) }}
              {{ _('If the person has alternative names, they will appear in the list under each name.') }}
    		  <br>&nbsp;<br>
	   		  {{ _("Clicking a name will take you to the selected person's page.") }} 
    		</p>

	        {% with messages = get_flashed_messages(with_categories=true) %}
	          {% if messages %}
	            <ul  class='flashes'>
	            {% for category, message in messages %}
	              <li class='flash_{{category}}'>{{ message }}</li>
	            {% endfor %}
	            </ul>
	          {% endif %}
	        {% endwith %}
        </div>

    {% if cnt %}
		<div id="alphanav">{% set alpha = "Â¤" %}
			<ul><li><a href="#" title="{{ _('Top') }}">&uarr;</a></li>
        {% for p in persons %}{% set ini = p.sortname[0]|upper %}
            {% if alpha != ini %}{%set alpha = ini %}
                <li><a href="#{{alpha}}" title="{{ _('Alphabetical Menu') }}: {{alpha}}">{{alpha}}</a></li>
            {% endif %}{% endfor %}
			</ul>
		</div>
		<table class="IndividualList">
			<thead>
				<tr><th></th>
					<th>{{ _('Person') }}</th>
                    <th>{{ _("Person's events") }}</th>
				</tr>
			</thead>
			<tbody>
	    {% for p in persons %}
	            <tr><td class="ColumnAlpha">{% set ini = p.sortname[0] %}
	               {% if alpha != ini %}{%set alpha = ini %}
		               <a id="{{alpha}}" name="{{alpha}}" title="{{ _('Back to Top') }}" href="#">{{alpha}}</a>
	               {% endif %}</td>

	                <td class="ColumnPerson"><div>
	                   <a href="/scene/person={{p.uniq_id}}"
	                     title="{{ _('see details of person %(id)s', id=p.uniq_id) }}">
		               {{p.names[0].firstname}} 
		               {% if p.names[0].surname %} <b>{{p.names[0].surname}}</b>
		               {% else %}<i>{{p.names[0].patronyme}}</i>{% endif %}
		               <small class="idno">[{{p.uniq_id}}</small></a><small class="idno"><a 
		                href="/scene/person/{{p.uniq_id}}">]</a></small>
		               {# TODO Remove later test link at ']' #}
		               <br><small class="refname" title="{{ _('Sorting name') }}">
		                  {{p.sortname}}</small>
	                </div></td>

	              <td class="ColumnEvent">
	        {% if p.events is iterable %}<ul>{% for e in p.events|sort(attribute='date') %}
		              <li><i>{{e.type|transl('evt')}} {{e.description}}</i>
		              {% if e.dates %}{{e.dates}} {% endif %}
		              {% if e.place %} | {{e.place}}{% endif %}</li>
		        {% endfor %}</ul>
		    {% else %}<u>See person {{p.events}}</u>
	        {% endif %}
	           </tr>
	    {% endfor %}
				</tr>
	{% else %}
        <table class="IndividualList">
            <tbody>
	        <tr><td>{{ _('No one found with search keys') }}<//td></tr>
	{% endif %}
			</tbody>
		</table>
	</div>
{% endblock %}
