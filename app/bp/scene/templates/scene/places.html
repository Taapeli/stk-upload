{# _templates/scene/locations.html_ #}
{% extends "/scene/layout.html" %}
{% block title %}{{ _('Places') }}{% endblock %}
{% block body %}
{{ super() }}
{% import '/scene/macros.html' as macro with context %}
{% set cnt = locations|count %}
{% set user = owner_filter.user %}
{% set next = owner_filter.scope %}
{% set filt_owners = owner_filter.filter %}
{% if filt_owners == 3 or filt_owners == 5 %}{#
	#   common_own   011 3 = 1+2 = user's data & demo
	#   common_batch 101 5 = 1+4 = user batch & demo #}
	{% set multi_owners = filt_owners - 1 %}
    {% set my_set = owner_filter.choices.as_str[filt_owners-1] %}
    {% set my_common = _('Demo-data') %}
{% else %}
    {% set multi_owners = 0 %}
    {% set my_set = owner_filter.choices.as_str[filt_owners] %}
{% endif %}

<div id="startdiv">
    <h2>{{ _('Places List') }}</h2>
    <p><small>– Kaikki data, ei huomioida aineiston omistajaa</small></p>
</div>

{{ macro.menu(menuno) }}
	<div class="content" id="Individuals">
        <div id="summaryarea">
            <div class="flex-container">
				<div id="description">
                   <p>{{ _('Displaying %(num)s distinct places', num=cnt) }}
                       {% if next[0] > ' ' %}{{ _('starting <tt>%(name)s</tt>', name=next[0]) }},
                       {% else %}{{ _('from begin') }},
                       {% endif %}{{ _('data set') }}
                       <b>{% if multi_owners %}
                            &FilledSmallSquare;&nbsp;{{my_set}} / <span class="owner">&nbsp;{{my_common}}&nbsp;</span>.
                       {% else %}{{my_set}}
                       {% endif %}</b>
                       {% if user %}
                       (<i><a href="/" title="{{ _('Change the data set shown') }}" 
                            style="text-decoration-line: underline;">{{ _('Change') }}</a></i>).
                       {% endif %}</p>
	           </div>
	           <div>
		           <form action="/scene/locations">
		             <fieldset>
		                <input type="hidden" name="c" value="50" >
		                <label for="fw">{{ _('Go to') }}</label>
		                <input type="text" name="fw" size="8" 
		                 title="{{ _('Starting letters of place') }}" 
		                 placeholder="{{ _('Place') }}">
		                <input type="submit" value=" > ">
		             </fieldset>
		           </form>
		       </div>
			</div>
		    {% with messages = get_flashed_messages(with_categories=true) %}
		      {% if messages %}
		        <ol  class='flashes'>
		        {% for category, message in messages %}
		          <li class='flash_{{category}}'>{{ message }}</li>
		        {% endfor %}
		        </ol>
		      {% endif %}
		    {% endwith %}
       </div>
       
        {% set last = locations|last %}
		<div id="alphanav">{% set alpha = "¤" %}
			<ul><li><a href="#" title="{{ _('Top') }}">&uarr;</a></li>
			    <li>{% if next[0] > ' ' %}
			         <a href="/scene/locations?fw=%20" title="{{ _('first page') }}" class="navlink">|&lt;</a>
			    {% else %}<span class="navlink">|&lt;</span>
			    {% endif %}</li>
                <li><span class="navlink" title="{{ _('previous page') }}" style="cursor:not-allowed"> &lt; </span></li>

        {% for p in locations %}
        	{% set ini = p.pname[0]|list|first %}
            {% if loop.changed(ini) %}
                <!-- li><a href="#{{ini}}" title="{{ _('Alphabetical Menu') }}: {{ini}}">{{ini}}</a></li -->
                <li><a href="javascript:jump('{{ini}}')" title="{{ _('Alphabetical Menu') }}: {{ini}}">{{ini}}</a></li>
            {% endif %}
        {% endfor %}
            {% if next[1].startswith('>') %}
                <li><span class="navlink" title="{{ _('no next page') }}" style="cursor:not-allowed"> &gt; </span></li>
            {% else %}
	            <li><a href="/scene/locations?{{ {'fw':next[1]} | urlencode }}" 
	                 title="{{ _('next page') }}" class="navlink"> &gt; </a></li>
            {% endif %}
			</ul>
		</div>
		<table class="IndividualList">
			<thead>
				<tr><th></th>
                    <th style="maxwidth:50%">{{ _('Location, related places') }}</th>
                    <th>{{ _('Location') }}</th>
				</tr>
			</thead>
			<tbody>
	{% if locations %}
	    {% for p in locations %}
	    	{% set ini = p.pname[0]|list|first %}
            <tr><td class="ColumnAlpha">
	            {% if loop.changed(ini) %}
	               <a id="{{ini}}" name="{{ini}}" title="{{ _('Back to Top') }}" href="#">{{ini}}</a>
                {% endif %}
                </td>
                <td class="ColumnPerson">
                   <div>
                      <a href="/scene/location/uuid={{p.uuid}}" class="inlink"
                        title="{{ _('see details of place %(id)s', id=p.uniq_id) }}"
                        id="{{p.uniq_id}}"><b>{{ macro.place_names(p) }}</b></a>
                      <span class="typedesc">{{p.type|transl('lt')}}</span>
			    {% if p.uppers[0] %}{% set e = p.uppers[0] %}
						<span class="typedesc">{{e.type|transl('lt_in')}}</span>
						<a href="/scene/location/uuid={{e.uuid}}" class="inlink"
						  title="{{ _('Go to location') }} id={{e.uniq_id}}">{{ macro.place_names(e) }}</a> 
		        {% endif %}
                   </div>
            {% if p.lowers %}
		           <ul style="margin:0 0 5px 1em;">
		        {% for e in p.lowers|sort(attribute='pname') %}    <li>
	                       <a href="/scene/location/uuid={{e.uuid}}"
	                         title="{{ _('Go to location') }} id={{e.uniq_id}}">{{ macro.place_names(e) }}</a>
	                       &nbsp;<span class="typedesc">{{e.type|transl('lt')}}</span>
                      </li>
		        {% endfor %}
		           </ul>
	        {% endif %}
	        <td>{% if p.coord %}({{p.coord[0]|round(4)}}, {{p.coord[1]|round(4)}}){% endif %}</td>
	    {% endfor %}
	{% endif %}
				</tr>
			</tbody>
		</table>
	</div>
{% endblock %}
