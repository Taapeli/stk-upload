{# _templates/scene/family.html_ #}
{% extends "/scene/sc_layout.html" %}
{% block title %}{{ _("Family details") }}{% endblock %}
{% block body %}
{{ super() }}
{% import '/scene/macros.html' as macro with context %}
<style>
u { color: DarkKhaki; text-decoration: none; }
.source-flex { display: flex; }
.source-flex > div {padding: 0 0 0 1em; }

div#summaryarea table {
    table-layout: auto;
    margin-top:1em;
	width: 100%;
}
div#summaryarea td {
	padding-right:1em;
	white-space: nowrap;
}
div#summaryarea table td:last-child{
    width:100%;
}
</style>

<div id="startdiv">
    <h1>{{ _("Family details") }}</h1>
    <div>{{ macro.show_use_case(no_change=true) }}</div>
</div>

{{ macro.menu(menuno) }}
    <div class="content" id="IndividualDetail">

{% include "flash_messages.html" %}

{% if family %}
        <h2>{{ _("Family")|capitalize }}</h2>
        <div id="summaryarea">
            <table><tbody>
                <tr><td class="ColumnAttribute">{{ _("Identifiers") }}</td>
                    <td class="Value TwoRows" colspan="2">{{macro.all_obj_ids(family)}}</td>
                </tr>
                <tr><td class="ColumnAttribute">{{ _("Relation") }}</td>
                    <td class="Value"> {{ family.rel_type|transl('marr') }}</td>
                    <td class="Value">{{ family.dates }}</td>
                </tr>
            {% for p in [family.father, family.mother] %}
                {% if p %}
                <tr><td class="ColumnAttribute">&nbsp;–&nbsp;{{p.role|transl('role')|capitalize}}</td>
                    <td class="Value">{{ macro.person_anon(p, iid) }}</td>
                    <td class="Value">
                   {% if p.event_birth and p.event_birth.dates %}&star;{{ p.event_birth.dates }}{% endif %}
                   {% if p.event_death and p.event_death.dates %}&#x271D;{{ p.event_death.dates }}{% endif %}
                    </td>
                </tr>
                {% endif -%}
            {% endfor %}
	{% if family.attrs %}
				{{ macro.attr_rows(family, colspan="2") }}
	{% endif %}
	{% if family.notes %}
	            <tr><td class="ColumnAttribute">{{ _("Notes") }}</td>
                    <td class="Value" colspan="2"><ul>
    	{% for note in family.notes %}
	                   <li>{{ macro.notelink(note) }}</li>
		{% endfor -%}
                    </ul>
	{% endif %}

            </tbody></table>
        </div>

	<form>
		<input type="hidden" name="uniq_id" value="{{ family.uniq_id }}">
	</form>

	{% if user_context.SHOW_DISCUSSION %}
    	<div id="comments_div" hx-get="/scene/hx-comment/comments_header" hx-trigger="load"></div> 
    {% endif %}

    {% if family.events %} 
        <h3>{{ _("Family Events") }}</h3>
        <div id="summaryarea">
            <table><tbody>
        {% for e in family.events|sort(attribute='dates') %}
                <tr><td class="ColumnAttribute">{{e.type|transl('evt')|capitalize}}</td>
                    <td class="ColumnDate {{e.dates.calendar_css()}}">{{e.dates}}</td>
                    <td class="ColumnPlace">
                    <a href="/place/{{e.place.iid}}" class="inlink"
                       title="{{e.place.type|transl('lt')}} {{ macro.obj_title(e.place) }}">
                      {{macro.place_names_lang(e.place)}}</a>{% if e.place.uppers %},
		              <small>{{macro.place_names_lang(e.place.uppers[0])}}</small>{% endif %}
		          </td>
                </tr>
        {% endfor %}

        {% if family.sources %}
                <tr><td colspan="3">&nbsp;</td></tr>
                <tr><td class="ColumnAttribute"><b>{{ _('Sources') }}</b></td>
                    <td class="Value" colspan="2"><ul>
            {% for s in family.sources %}
                        <li><a href="/source/{{s.iid}}" class="inlink">{{s.stitle}}</a>, 
                {% for c in s.citations %}
                            {{ _("Page") }}: {{c.page}}
                {% endfor -%}
                {% for repo in s.repositories %}
                            <br>&nbsp;&nbsp; – {% if repo.medium %}{{repo.medium|transl('medium')}}{% endif %}</span>
                            {{ _('in the repository') }} <b>{{repo.rname}}</b>
                {% endfor -%}
                        </li>
            {% endfor -%}
                    </ul></td>
        {% endif -%}
                </tr>
            </tbody></table>

      </div> <!-- events -->
    {% endif %}

    {% if family.children %} 
	        <h3>{{ _("Children") }}</h3>
	        <div id="summaryarea">
	            <table style="margin-top:1em;"><tbody>
	        <!-- |sort(attribute='event_birth.dates') -->
	        {% for p in family.children %}
	                <tr><td class="ColumnAttribute">{{p.sex|transl('child')}}</td>
	                    <td class="Value">{{ macro.person(p, iid) }}</td>
	                    <td class="Value">
               {% if p.event_birth and p.event_birth.dates %}&star;{{ p.event_birth.dates }}{% endif %}
	           {% if p.event_death and p.event_death.dates %}&#x271D;{{ p.event_death.dates }}{% endif %}
	                    </td>
	                </tr>
	        {% endfor %}
            {% if family.num_hidden_children %}
                    <tr><td colspan="2" class="Value">
                        ({{ ngettext("one hidden", "%(num)d hidden", family.num_hidden_children) }})
                    </td></tr>
            {% endif %}
	            </tbody></table>
 			</div>
    {% endif %}
 
{% endif %}
        <p>&nbsp;</p> <!-- family -->
    </div>
</div>
{% endblock %}

