{# _myapp/templates/list_persons.html_ #}
{% extends "/scene/sc_layout.html" %}
{% block title %}{{ _('List of persons') }}{% endblock %}
{% block body %}
{{ super() }}
{% import '/scene/macros.html' as macro with context %}

{% set cnt = persons|count %}
{% set next_fw = user_context.next_name('fw') %}
{% set next_bw = user_context.next_name('bw') %}
{% set next_at_end = user_context.at_end() %}

<div id="startdiv">
    <h1>{{ _('Persons') }}</h1>
    <div>{{ macro.show_use_case() }}</div>
</div>

{{ macro.menu(menuno) }}
<div id="popup_app">

	<div class="content" id="Individuals">
        <div id="summaryarea">
            <div class="flex-container">
	           <div id="description_box">
                   <p>{{ _('Displaying %(num)s distinct persons', num=cnt) }}
	{% if next_fw > ' ' %}
					   {{ _('starting <tt>%(name)s</tt>', name=user_context.first) }}.
	{% else %}         {{ _('from begin') }}.
	{% endif %}
    {% if num_hidden %}
                       		<br>-
						    {{ ngettext(
						    	'%(num)s person hidden because of privacy protection', 
						    	'%(num)s people hidden because of privacy protection', 
						    	num_hidden ) 
						    }}
    {% endif %}
                       </p>
	           </div>
	           <div class="SearchBox">
	               <form action="/scene/persons/all">
	                 <fieldset>
	                    <input type="hidden" name="c" value="50" >
	                    <label for="fw">{{ _('Go to') }}</label>
	                    <input type="text" name="fw" size="8" 
	                     title="{{ _('Starting letters of surname') }}" 
	                     placeholder="{{ _('Surname') }}">
	                    <input type="submit" value=" > ">
	                 </fieldset>
	               </form>
	           </div>
            </div>

{% include "flash_messages.html" %}

        </div>
  <div id="hx-fam"></div>

    {% if cnt %}
		<div id="alphanav">{% set alpha = "Â¤" %}
			<ul><li><a href="#" title="{{ _('Top of page') }}">&uarr;</a></li>
				{{ macro.buttons_bw(user_context, "/scene/persons/all") }}
            {% for p in persons %}
                {% set ini = p.sortname[0] %}
                {% if loop.changed(ini) %}{% if not ini == "#" %}
	                <li><a href="javascript:jump('{{ini}}')" title="{{ _('Alphabetical Menu') }}: {{ini}}">{{ini}}</a></li>
                {% endif %}{% endif %}
            {% endfor %}
				{{ macro.buttons_fw(user_context, "/scene/persons/all") }}
            </ul>

		</div>
		<table class="IndividualList">
			<thead>
				<tr><th></th>
					<th>{{ _('Person') }}</th>
                    <th>{{ _("Events") }}</th>
				</tr>
			</thead>
			<tbody>

	    {% for p in persons %}
	            <tr><td class="ColumnAlpha">
           {% set ini = p.sortname[0] %}
           {% if loop.changed(ini) %}
              {% if ini == "#" %}{% set symbol = 'â€“' %}
              {% else %}{% set symbol = ini %}{% endif %}
		               <a id="{{symbol}}" name="{{ini}}" title="{{ _('Back to Top') }}" 
		                  href="#">{{symbol}}</a>
	       {% endif %}
	                </td>

	                <td class="ColumnPerson">
	                    <div>
                            <div class="detail_link" alt="{{p.uniq_id}}">
                                {{p.sex_symbol()}} 
                                {{ macro.person(p) }}
                                 <div class="pop-open-family" 
                                    v-on:mouseover="showPopup(iid='{{p.iid}}',$event)"
                                    >ðŸ‘ª</div>                            

                             <br>&nbsp;&nbsp;&nbsp;&nbsp;{{ macro.obj_ids(p) }}
	                    </div>
	                </td>

                <td class="ColumnEvent">
           {% if p.events is iterable %}
                    <div>
              {% for e in p.events|sort() %}
                 {% if e.type == "Birth" or e.type == "Death" %}{% set ecl = "major" %}
                 {% else %}{% set ecl = "minor" %}{% endif %}
                        <div class="eventgrid">
                            <div class="col col_event">
                                <span class="evtype {{ecl}}">{{e.type|transl('evt')|lower}}</span>
                                {{e.description}}</div>
                            <div class="col col_date">
                    {% if e.dates %}
                                <span class="{{e.dates.calendar_css()}}">{{e.dates}}</span> 
                    {% endif %}
                    {% if e.place %} | {{e.place}}
                    {% endif %}
                            </div>
                      </div>
              {% endfor %}
                    </div>
           {% else %}<u>See person {{p.events}}</u>
                </td>
           {% endif %}
	    {% endfor %}

        {% if next_at_end %}
                <tr><td class="ColumnAlpha"></td>
                    <td colspan="2" id="lastitem_badge">
                        <i>{{ _('The last item found') }}</i>
                    </td>
                </tr>
	    {% endif %}
            </tbody>
        </table>
	{% else %}
        <div class="NotFound">
            <p>{{ _('No one found with search keys starting "%(name)s"', name=next_fw) }}.</p>
            {% if next_fw %}<p>&nbsp;&#9656; <a href="/scene/persons/all?fw=%20" 
                title="{{ _('first page') }}">{{ _("Go to the first person") }}</a></p>
            {% endif %}
        </div>
        <p>&nbsp;</p>
	{% endif %}
    </div>

  <div id="pop-window" v-show="isShow" v-on:mouseleave="isShow=false">
    <!--div id="close-x">âœ•</div -->
    <div id="pop-buttons" v-if="families.length > 1">
      <button 
         v-on:mouseover="changeFamily(index, $event)"
         v-on:touchstart="changeFamily(index, $event)"
         v-for="(f, index) of families" :key="f.id"
         v-bind:class="{ 'tab': true, 'tab_active': (index==(currentIndex-1)) }">
            ${f.role_lang}</button>
    </div>

    <div class="pop-container">
      <div class="pop-text" v-if="currentIndex">
          <p><a v-bind:href="current.href" title="{{ _('See family') }}" class="inlink">
              ${translations['family']}</a>
              ${current.rel_type} ${datesStr(current.dates)}
          </p>
          <ul>
              <li v-for="p in current.parents" :key="p.iid">
                ${p.role} 
                <a v-bind:href="p.href" title="Katso henkilÃ¶Ã¤"
                   v-bind:class="{ 'inlink': true, 'link_self': p.is_self }">
                   ${p.name[1]} <i>${p.name[2]}</i> <b>${p.name[0]}</b></a>
                  <span v-if="p.birth_date">s.&nbsp;${datesStr(p.birth_date)}</span>
              </li>
              <li v-if="current.has_children">${translations['children']}:
                 <ul>
                     <li v-for="p in current.children" :key="p.iid">${p.gender}
                       <a v-bind:href="p.href" title="Katso henkilÃ¶Ã¤"
                          v-bind:class="{ 'inlink': true, 'link_self': p.is_self }">
                          ${p.name[1]} <i>${p.name[2]}</i> <b>${p.name[0]}</b></a>
                       <span v-if="p.birth_date">s.&nbsp;${datesStr(p.birth_date)}</span>
                     </li>
                 </ul>
              </li>
          </ul>
      </div>
    </div>
    <div style="margin-right: 20pt; margin-top: 5pt;" v-show="families.length == 0">
        ${message}
    </div>
  </div>
  <div class="pop-error" v-show="false"><!-- For debugging change v-show -->
    <p style="border:2px solid red; position: fixed; top: 5em;right: 0;">
       Families:<br>${message}</p>
  </div>

</div>

<!-- vue and assistant methods -->
<script src="/static/js/family_popup.js"></script>

{% endblock %}
