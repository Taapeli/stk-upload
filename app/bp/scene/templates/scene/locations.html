{# _templates/scene/locations.html_ #}
{% extends "/scene/layout.html" %}
{% block title %}{{ _('Places') }}{% endblock %}
{% block body %}
{{ super() }}
{% import '/scene/macros.html' as macro with context %}

<h2>{{ _('Places List') }}</h2>
{{ macro.menu(4) }}
	<div class="content" id="Individuals">
		<p id="description">
		{{ _('This page contains a directory of all the places and the closest lower-level locations beneath them.') }}
		</p>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ol  class='flashes'>
        {% for category, message in messages %}
          <li class='flash_{{category}}'>{{ message }}</li>
        {% endfor %}
        </ol>
      {% endif %}
    {% endwith %}
		<div id="alphanav">
			<ul><li><a href="#" title="{{ _('Top') }}">&uarr;</a></li>
        {% for p in locations %}
        	{% set ini = p.pname[0]|list|first %}
            {% if loop.changed(ini) %}
                <li><a href="#{{ini}}" title="{{ _('Alphabetical Menu') }}: {{ini}}">{{ini}}</a></li>
            {% endif %}
        {% endfor %}
			</ul>
		</div>
		<table class="IndividualList">
			<thead>
				<tr><th></th>
                    <th style="maxwidth:50%">{{ _('Location, related places') }}</th>
                    <th>{{ _('Location') }}</th>
				</tr>
			</thead>
			<tbody>
	{% if locations %}
	    {% for p in locations %}
	    	{% set ini = p.pname[0]|list|first %}
            <tr><td class="ColumnAlpha">
	            {% if loop.changed(ini) %}
	               <a id="{{ini}}" name="{{ini}}" title="{{ _('Back to Top') }}" href="#">{{ini}}</a>
                {% endif %}
                </td>
                <td class="ColumnPerson">
                   <div>
                      <a href="/scene/location={{p.uniq_id}}" class="id"
                        title="{{ _('see details of place %(id)s', id=p.uniq_id) }}"
                        id="{{p.uniq_id}}">{{p.uniq_id}}</a> <b>{{p.pname|join(' • ')}}</b>
                      <span class="typedesc">{{p.type|transl('lt')}}</span>
			    {% if p.uppers[0] %}{% set e = p.uppers[0] %}
						<span class="typedesc">{{e.type|transl('lt_in')}}</span>
						<a href="#{{e.uniq_id}}" 
						  title="{{ _('Go to location') }} id={{e.uniq_id}}">{{e.pname|join(' • ')}}</a> 
		        {% endif %}
                   </div>
            {% if p.lowers %}
		           <ul style="margin:0 0 5px 1em;">
		        {% for e in p.lowers|sort(attribute='pname') %}    <li>
	                       <a href="#{{e.uniq_id}}"
	                         title="{{ _('Go to location') }} id={{e.uniq_id}}">{{e.pname|join(' • ')}}</a>
	                       &nbsp;<span class="typedesc">{{e.type|transl('lt')}}</span>
                      </li>
		        {% endfor %}
		           </ul>
	        {% endif %}
	        <td>{% if p.coord %}({{p.coord[0]|round(4)}}, {{p.coord[1]|round(4)}}){% endif %}</td>
	    {% endfor %}
	{% endif %}
				</tr>
			</tbody>
		</table>
	</div>
{% endblock %}
