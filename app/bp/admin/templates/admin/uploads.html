{# _myapp/templates/gr_result.html_ #}
{% extends "/admin/layout.html" %}
{% block title %}{{ _("Uploads") }}{% endblock %}
{% block body %}
    {{ super() }}
    <!-- meta http-equiv="refresh" content="30" -->
    {% if users %}
    	<h2>{{ _("Uploads for users: ") }} <i>{{users}}</i></h2>
    {% else %}
	    <h2>{{ _("Uploads for all users") }}</h2>
    {% endif %}
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ol  class='flashes'>
        {% for category, message in messages %}
          <li class='flash_{{category}}'>{{ message }}</li>
        {% endfor %}
        </ol>
      {% endif %}
    {% endwith %}
    <div class="helptext">
    	<b>{{ _("Status for differents steps in XML file upload:") }}</b>
    	<table class=legend>
    	<tr>
    	<td>1
    	<td>{{ _("UPLOADED") }}     
    	<td>{{ _("the file has been uploaded to server") }}
    	<tr>
    	<td>2
    	<td>{{ _("STORING") }}
    	<td>{{ _("the file content is being stored to the database") }}
    	<tr>
    	<td>3
    	<td>{{ _("STORED") }}
    	<td>{{ _("the file content has been stored to the database") }}
    	<tr>
    	<td>4
    	<td>{{ _("ERROR") }} / {{ _("FAILED") }}
    	<td>{{ _("there was an error") }}
    	</table>
	<p>
    </div>
        <table>
           <tr>
			    {% if not user %}
	                <th>{{ _("User id") }}</th>
			    {% endif %}
                <th>{{ _("Upload time") }}</th>
                <th>{{ _("XML file") }}</th>
                <th>{{ _("Status") }}</th>
                <th>{{ _("Operations") }}</th>
           </tr>
	    {% for upload in uploads %}
	       <tr>
			    {% if not user %}
                  {% if current_user.username == upload.user %}
                    <td title="{{ _('me') }}">&#9733; <b>{{upload.user}}</b></td>{% else %}
                    <td>{{upload.user}}{% endif %}</td>
			      {% endif %}
	           <td class="msg_INFO">{{upload.upload_time_s}}</td>
	           <td class="msg_INFO">
    	           <a href=/admin/xml_download/{{upload.user}}/{{upload.xmlname | urlencode}}>
    	               {{upload.xmlname}}</a> 
	           </td>
	           <td class="msg_INFO">{{upload.status}}</td>
	           <td class="msg_INFO">
	           		<a href=/admin/start_upload/{{upload.user}}/{{upload.xmlname | urlencode}}>
	           			{{ _("Store to database") }}</a> |
	           		<a href=/admin/show_upload_log/{{upload.user}}/{{upload.xmlname | urlencode}}>
	           			{{ _("Show log") }}</a> |
	           		<a href=/admin/xml_delete/{{upload.user}}/{{upload.xmlname | urlencode}}>
	           			{{ _("Delete file") }}</a> &nbsp;
	           	</td>
	       </tr>
	    {% endfor %}
	    </table>
	    <br>
	    {{ _("Number of files") }}: {{ uploads|count }}
    <p>&rtrif; <a href="list_users">{{ _("List of users") }}</a></p>
{% endblock %}
</body>
</html>

